<h2>5.2 - Accessing Deploy Previews</h2>
<p><img src="images/image13.png" alt="alt_text" title="image_tooltip"></p>
<p>Ensuring easy access to each deploy preview is crucial for the functionality of Campfire. Within our setup, each deploy preview operates as a separate task in AWS ECS, which automatically assigns a public IP to these tasks. A task in this context refers to a running instance of a containerized application, specified by its CPU, memory, and network settings. These tasks are crucial for handling the containerized applications of each pull request.</p>
<p>However, these public IPs can change if a task is restarted due to updates, configuration changes, or scaling operations. To manage the dynamic nature of public IPs, we implemented an application load balancer. This load balancer acts as a router, distributing incoming traffic across our preview tasks efficiently. It utilizes listeners to monitor and direct traffic based on predefined rules.</p>
<p>The traffic is then routed through these rules to target groups, which are collections of tasks configured within ECS to receive specific types of traffic. AWS manages the routing from the load balancer to these target groups and ensures that the correct tasks receive the necessary traffic. This setup ensures that access to deploy previews remains stable and continuous, even when individual tasks undergo IP changes due to restarts, thereby maintaining seamless access to all deploy previews.</p>
<p><img src="images/image14.png" alt="alt_text" title="image_tooltip"></p>
<p>Initially, we experimented with path-based rules for routing â€“ directing traffic to specific services based on URL paths, for example, &quot;/client-app/12&quot; for accessing the preview of pull request 12. However, this approach proved inadequate due to 404 errors when browsers requested additional resources not accounted for in the path-based rules.</p>
<p><img src="images/image15.png" alt="alt_text" title="image_tooltip"></p>
<p>The solution evolved to using host-based routing, where the load balancer would manage requests to a host like &quot;client-app-12.preview.campfire.com&quot; as an example, ensuring all subsequent resource requests for a particular preview consistently reached the correct service.</p>
<p><img src="images/image16.png" alt="alt_text" title="image_tooltip"></p>
<p>This method eliminated the 404 issue as the host-based approach accurately directed all related traffic to the appropriate deploy preview environment, regardless of the specific resource being requested.</p>
