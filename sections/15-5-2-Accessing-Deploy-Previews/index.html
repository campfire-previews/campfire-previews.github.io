<h2>5.2 - Accessing Deploy Previews</h2>
<p><img src="images/case-study/access.png" alt="Campfire architecture highlighting application load balancer"></p>
<p>Access to each deploy preview was the next step for Campfire. Within our setup with AWS ECS, each deploy preview operates as a separate task. A task is a running instance of a containerized application, specified by its CPU, memory, and network settings in a task definition. Each task is automatically assigned a public IP that can be used to access the running instance. These public IPs can change if a task is restarted due to updates, configuration changes, or scaling operations. To manage the dynamic nature of public IPs, we implemented an application load balancer.</p>
<p>In general a load balancer is typically used to distribute incoming network traffic across multiple instances of a single application. In Campfire’s case, since we only have one instance of a client’s application as a container, this load balancer acts as a router, distributing incoming traffic across our preview tasks efficiently. It utilizes listeners to direct traffic based on Campfire’s predefined rules.</p>
<p>The traffic is then routed through these rules to target groups, which are collections that map to specific ECS tasks, regardless of their currently assigned IP addresses. Having an application load balancer means access to Campfire’s deploy previews remains stable and continuous, even when individual tasks undergo IP changes due to restarts.</p>
<p><img src="images/case-study/alb-listener.png" alt="Load balancer routing to target groups that direct traffic to ECS tasks"></p>
<p>When configuring rules for the load balancer’s listener we first experimented with path-based rules for routing – directing traffic to specific services based on URL paths, for example, &quot;/client-app/12&quot; for accessing the preview of pull request #12. However, this approach proved inadequate due to 404 errors when browsers requested additional resources not accounted for in the path-based rules.</p>
<p><img src="images/case-study/path-based.png" alt="Client requesting resources using path routing from the application load balancer"></p>
<p>The solution evolved to using host-based routing, where the load balancer would manage requests to a host like &quot;client-app-12.preview.campfire.com&quot; as an example, ensuring all subsequent resource requests for a particular preview consistently reached the correct service.</p>
<p><img src="images/case-study/host-based.png" alt="Client requesting resources using host based rules from the application load balancer using subdomains from the application load balancer"></p>
<p>This method eliminated the 404 issue as the host-based approach accurately directed all related traffic to the appropriate deploy preview environment, regardless of the specific resource being requested.</p>
